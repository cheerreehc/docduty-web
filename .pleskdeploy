#!/bin/bash

echo "üîß ‡πÄ‡∏£‡∏¥‡πà‡∏° Deploy DocDuty..."

# 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
if [ ! -d "node_modules" ]; then
  echo "üì¶ Installing dependencies..."
  npm install
fi

# 2. Build static site (‡∏à‡∏∞‡πÉ‡∏ä‡πâ output: 'export' ‡∏à‡∏≤‡∏Å next.config.js)
echo "üèóÔ∏è Building static export..."
npm run build

# 3. ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ö‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
echo "üßπ Cleaning old files..."
find . -mindepth 1 -maxdepth 1 \
  ! -name 'out' \
  ! -name '.well-known' \
  ! -name 'node_modules' \
  ! -name '.git' \
  ! -name '.pleskdeploy' \
  -exec rm -rf {} +

# 4. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å out ‡πÑ‡∏õ‡∏¢‡∏±‡∏á root
echo "üöö Moving build files..."
cp -r out/* .

# 5. ‡∏•‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå out
rm -rf out

echo "‚úÖ Deploy ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"
